{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Dashboard</title>
    <link type="text/css" href="{% static 'styles/style.css' %}" rel="stylesheet" />
    <link type="text/css" href="{% static 'styles/dashboards.css' %}" rel="stylesheet" />
    <link type="image/x-icon" href="{% static 'img/est.ico' %}" rel="icon" />

</head>
<body>
    
    <div id="header">

        <div class="header-wrap">

            {% if request.user.is_staff == True %}
<!--            <a href="{% url 'authenticator:listings' %}">-->

            <div class="site-id" onclick="history.back()">
                <img src="{% static '/img/back.svg' %}" />
            </div>

            {% else %}
            <div class="site-id">
                <img src="{% static 'img/est.svg' %}" />
            </div>
            {% endif %}

            <div>
                <!-- <a href="upload.html"><button class="itm-btn">Upload</button></a> -->
                <a href="{% url 'authenticator:logout' %}"><button class="itm-btn">Logout</button></a>
            </div>

            <!-- profile  -->
            <!-- <a href="pages/login.html"><div class="profile"> </div></a> -->
        </div>
        
    </div>

    <div class="header-pad"></div>



    <div class="main">

        {% if not applied_estates %}
        <div class="center-box">
            <center>
                <div class="msg">
                    <img src="{% static 'img/none.png' %}" width="240px"/>
                    <h4>There are no estates here!</h4>
                    <p>
                        {{ error }}
                    </p>
                </div>

                <a href="{% url 'browser:index' %}" ><button style="margin-bottom: 15px;">Browse for Estate</button></a>
            </center>
        </div>

        {% else %}

        <div class="section-header">
<!--            <h2> {{ request.user.username }} Applications</h2>-->
                {% if request.user.is_staff == True %}
                    <h2> {{ client.username }}'s Applications ({{ applied_estates_count }}/3)</h2>
                {% else %}
                    <h2> Your Applications ({{ applied_estates_count }}/3)</h2>
                {% endif %}
        </div>

        <!-- container component -->
        <div class="container">
            {% for estate in applied_estates %}
            <div class="item">


                <div class="item-img-box">
                    <img src="{{ estate.img.url }}" alt="" />
                </div>

                <div class="item-detail">
                    <div class="desc">
                        <div class="icntext-container">
                            <div class="icn-img">
                                <img src="{% static 'img/villa.svg' %}" />
                            </div>
                            <div class="icn-text">
                                <h3>{{ estate.title }}</h3>
                            </div>
                        </div>
                        <div class="icn2">

                            <div class="icntext-container left">
                                <div class="icn-img">
                                    <img src="{% static 'img/location.svg' %}" />
                                </div>
                                <div class="icn-text">
                                    <p>{{ estate.area }}</p>
                                </div>
                            </div>

                            <div class="icntext-container">
                                <div class="icn-img" style="margin: 0px;">
                                    <img src="{% static 'img/pay.svg' %}" />
                                </div>

                                <div class="icn-text">
                                    <p class="formatted-price" >{{ estate.total_price }}</p>
                                </div>

                            </div>

                        </div>
                    </div>

                    <div style="display:flex; align-items: center;">
                        <a href="{% url 'authenticator:delete_estate' estate.id %}">
                        <div class="dashboard-icn-box">
                            <img src="{% static 'img/x.svg' %}" alt="" />
                        </div>
                        </a>
                        <a href="{% url 'browser:detail-app' estate.id %}"><button class="itm-btn">View</button></a>
                    </div>
                </div>

            </div>
            {% endfor %}
        </div>

        {% endif %}
        <!-- conditional declaration ends here-->



    </div>

    <script>
        //formating prices
        // Get all elements with the "formatted-price" class
        const priceElements = document.querySelectorAll('.formatted-price');

        // Loop through each element and format the price with commas
        priceElements.forEach(element => {
            // Parse the integer value and format it with commas
            const price = parseInt(element.textContent, 10);
            const formattedPrice = price.toLocaleString();
            // Update the element's content with the formatted price
            element.textContent = formattedPrice;
        });
    </script>


</body>
</html>